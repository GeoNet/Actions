name: reusable go apps
on:
  workflow_call:
    inputs:
      paths:
        required: false
        type: string
        description: |
          the Go entrypoint paths for applications, where there they have `package main`
          e.g: ./cmd/thing1 ./cmd/thing2
      updateGoVersionAutoMerge:
        type: boolean
        default: false
        required: false
        description: |
          specifies whether to auto merge PRs for Go version updates to go.mod files
jobs:
  go-build:
    if: ${{ contains(fromJSON('["workflow_call", "push", "pull_request"]'), github.event_name) }}
    uses: GeoNet/Actions/.github/workflows/reusable-go-build-smoke-test.yml@main
    with:
      paths: ${{ inputs.paths }}
  gofmt:
    if: ${{ contains(fromJSON('["workflow_call", "push", "pull_request"]'), github.event_name) }}
    uses: GeoNet/Actions/.github/workflows/reusable-gofmt.yml@main
  golangci-lint:
    if: ${{ contains(fromJSON('["workflow_call", "push", "pull_request"]'), github.event_name) }}
    uses: GeoNet/Actions/.github/workflows/reusable-golangci-lint.yml@main
  go-test:
    if: ${{ contains(fromJSON('["workflow_call", "push", "pull_request"]'), github.event_name) }}
    uses: GeoNet/Actions/.github/workflows/reusable-go-test.yml@main
  go-vet:
    if: ${{ contains(fromJSON('["workflow_call", "push", "pull_request"]'), github.event_name) }}
    uses: GeoNet/Actions/.github/workflows/reusable-go-vet.yml@main
  govulncheck:
    if: ${{ contains(fromJSON('["workflow_call", "push", "pull_request"]'), github.event_name) }}
    uses: GeoNet/Actions/.github/workflows/reusable-govulncheck.yml@main
  update-go-version:
    if: ${{ contains(fromJSON('["workflow_call", "schedule"]'), github.event_name) }}
    uses: GeoNet/Actions/.github/workflows/reusable-update-go-version.yml@main
    with:
      autoMerge: ${{ inputs.updateGoVersionAutoMerge }}
